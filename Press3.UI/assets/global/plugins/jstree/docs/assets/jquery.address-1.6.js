/*! jQuery Address v.1.6 | (c) 2009, 2013 Rostislav Hristov | jquery.org/license */
(function(n){n.address=function(){var ht=function(t){var i=n.extend(n.Event(t),function(){for(var r={},t=n.address.parameterNames(),i=0,u=t.length;i<u;i++)r[t[i]]=n.address.parameter(t[i]);return{value:n.address.value(),path:n.address.path(),pathNames:n.address.pathNames(),parameterNames:t,parameters:r,queryString:n.address.queryString()}}.call(n.address));return n(n.address).trigger(i),i},y=function(n){return Array.prototype.slice.call(n)},b=function(){return n().bind.apply(n(n.address),Array.prototype.slice.call(arguments)),n.address},si=function(){return n().unbind.apply(n(n.address),Array.prototype.slice.call(arguments)),n.address},rt=function(){return tt.pushState&&t.state!==i},pt=function(){return("/"+s.pathname.replace(new RegExp(t.state),"")+s.search+(ut()?"#"+ut():"")).replace(ii,"/")},ut=function(){var n=s.href.indexOf("#");return n!=-1?s.href.substr(n+1):""},c=function(){return rt()?pt():ut()},wt=function(){try{return top.document!==i&&top.document.title!==i&&top.jQuery!==i&&top.jQuery.address!==i&&top.jQuery.address.frames()!==!1?top:window}catch(n){return window}},bt=function(){return"javascript"},ct=function(n){return n=n.toString(),(t.strict&&n.substr(0,1)!="/"?"/":"")+n},l=function(n,t){return parseInt(n.css(t),10)},k=function(){if(!ot){var n=c(),i=decodeURI(r)!=decodeURI(n);i&&(v&&w<7?s.reload():(v&&!et&&t.history&&a(lt,50),r=n,d(o)))}},d=function(n){return a(hi,10),ht(gt).isDefaultPrevented()||ht(n?ni:ti).isDefaultPrevented()},hi=function(){if(t.tracker!=="null"&&t.tracker!==g){var f=n.isFunction(t.tracker)?t.tracker:u[t.tracker],r=(s.pathname+s.search+(n.address&&!rt()?n.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");n.isFunction(f)?f(r):n.isFunction(u.urchinTracker)?u.urchinTracker(r):u.pageTracker!==i&&n.isFunction(u.pageTracker._trackPageview)?u.pageTracker._trackPageview(r):u._gaq!==i&&n.isFunction(u._gaq.push)&&u._gaq.push(["_trackPageview",decodeURI(r)])}},lt=function(){var n=bt()+":"+o+";document.open();document.writeln('<html><head><title>"+e.title.replace(/\'/g,"\\'")+"<\/title><script>var "+p+' = "'+encodeURIComponent(c()).replace(/\'/g,"\\'")+(e.domain!=s.hostname?'";document.domain="'+e.domain:"")+"\";<\/script><\/head><\/html>');document.close();";w<7?f.src=n:f.contentWindow.location.replace(n)},kt=function(){if(it&&ui!=-1){for(var n,u=it.substr(ui+1).split("&"),i=0;i<u.length;i++)n=u[i].split("="),/^(autoUpdate|history|strict|wrap)$/.test(n[0])&&(t[n[0]]=isNaN(n[1])?/^(true|yes)$/i.test(n[1]):parseInt(n[1],10)!==0),/^(state|tracker)$/.test(n[0])&&(t[n[0]]=n[1]);it=g}r=c()},dt=function(){var y,g,b;fi||(fi=h,kt(),n('a[rel*="address:"]').address(),t.wrap&&(y=n("body"),g=n("body > *").wrapAll('<div style="padding:'+(l(y,"marginTop")+l(y,"paddingTop"))+"px "+(l(y,"marginRight")+l(y,"paddingRight"))+"px "+(l(y,"marginBottom")+l(y,"paddingBottom"))+"px "+(l(y,"marginLeft")+l(y,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+p+'" style="height:100%;overflow:auto;position:relative;'+(ft&&!window.statusbar.visible?"resize:both;":"")+'" />'),n("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),ft&&n('<style type="text/css" />').appendTo("head").text("#"+p+"::-webkit-resizer { background-color: #fff; }")),v&&!et&&(b=e.getElementsByTagName("frameset")[0],f=e.createElement((b?"":"i")+"frame"),f.src=bt()+":"+o,b?(b.insertAdjacentElement("beforeEnd",f),b[b.cols?"cols":"rows"]+=",0",f.noResize=h,f.frameBorder=f.frameSpacing=0):(f.style.display="none",f.style.width=f.style.height=0,f.tabIndex=-1,e.body.insertAdjacentElement("afterBegin",f)),a(function(){n(f).bind("load",function(){var n=f.contentWindow;r=n[p]!==i?n[p]:"";r!=c()&&(d(o),s.hash=r)});f.contentWindow[p]===i&&lt()},50)),a(function(){ht("init");d(o)},1),rt()||(v&&w>7||!v&&et?u.addEventListener?u.addEventListener(nt,k,o):u.attachEvent&&u.attachEvent("on"+nt,k):wi(k,50)),"state"in window.history&&n(window).trigger("popstate"))},ci=function(){decodeURI(r)!=decodeURI(c())&&(r=c(),d(o))},li=function(){u.removeEventListener?u.removeEventListener(nt,k,o):u.detachEvent&&u.detachEvent("on"+nt,k)},ai=function(n){n=n.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[];return{browser:t[1]||"",version:t[2]||"0"}},vi=function(){var n={},t=ai(navigator.userAgent);return t.browser&&(n[t.browser]=!0,n.version=t.version),n.chrome?n.webkit=!0:n.webkit&&(n.safari=!0),n},i,g=null,p="jQueryAddress",yi="string",nt="hashchange",pi="init",gt="change",ni="internalChange",ti="externalChange",h=!0,o=!1,t={autoUpdate:h,history:h,strict:h,frames:h,wrap:o},at=vi(),w=parseFloat(at.version),ft=at.webkit||at.safari,v=!n.support.opacity,u=wt(),e=u.document,tt=u.history,s=u.location,wi=setInterval,a=setTimeout,ii=/\/{2,9}/g,ri=navigator.userAgent,et="on"+nt in u,f,it=n("script:last").attr("src"),ui=it?it.indexOf("?"):-1,vt=e.title,ot=o,fi=o,ei=h,st=o,r=c(),yt,oi;return v&&(w=parseFloat(ri.substr(ri.indexOf("MSIE")+4)),e.documentMode&&e.documentMode!=w&&(w=e.documentMode!=8?7:8),yt=e.onpropertychange,e.onpropertychange=function(){yt&&yt.call(e);e.title!=vt&&e.title.indexOf("#"+c())!=-1&&(e.title=vt)}),tt.navigationMode&&(tt.navigationMode="compatible"),document.readyState=="complete"?oi=setInterval(function(){n.address&&(dt(),clearInterval(oi))},50):(kt(),n(dt)),n(window).bind("popstate",ci).bind("unload",li),{bind:function(){return b.apply(this,y(arguments))},unbind:function(){return si.apply(this,y(arguments))},init:function(){return b.apply(this,[pi].concat(y(arguments)))},change:function(){return b.apply(this,[gt].concat(y(arguments)))},internalChange:function(){return b.apply(this,[ni].concat(y(arguments)))},externalChange:function(){return b.apply(this,[ti].concat(y(arguments)))},baseURL:function(){var n=s.href;return n.indexOf("#")!=-1&&(n=n.substr(0,n.indexOf("#"))),/\/$/.test(n)&&(n=n.substr(0,n.length-1)),n},autoUpdate:function(n){return n!==i?(t.autoUpdate=n,this):t.autoUpdate},history:function(n){return n!==i?(t.history=n,this):t.history},state:function(n){if(n!==i){t.state=n;var r=pt();return t.state!==i&&(tt.pushState?r.substr(0,3)=="/#/"&&s.replace(t.state.replace(/^\/$/,"")+r.substr(2)):r!="/"&&r.replace(/^\/#/,"")!=ut()&&a(function(){s.replace(t.state.replace(/^\/$/,"")+"/#"+r)},1)),this}return t.state},frames:function(n){return n!==i?(t.frames=n,u=wt(),this):t.frames},strict:function(n){return n!==i?(t.strict=n,this):t.strict},tracker:function(n){return n!==i?(t.tracker=n,this):t.tracker},wrap:function(n){return n!==i?(t.wrap=n,this):t.wrap},update:function(){return st=h,this.value(r),st=o,this},title:function(n){return n!==i?(a(function(){vt=e.title=n;ei&&f&&f.contentWindow&&f.contentWindow.document&&(f.contentWindow.document.title=n,ei=o)},50),this):e.title},value:function(n){if(n!==i){if(n=ct(n),r==n&&!st)return;if(r=n,t.autoUpdate||st){if(d(h))return this;rt()?tt[t.history?"pushState":"replaceState"]({},"",t.state.replace(/\/$/,"")+(r===""?"/":r)):(ot=h,ft?t.history?s.hash="#"+r:s.replace("#"+r):r!=c()&&(t.history?s.hash="#"+r:s.replace("#"+r)),v&&!et&&t.history&&a(lt,50),ft?a(function(){ot=o},1):ot=o)}return this}return ct(r)},path:function(n){if(n!==i){var t=this.queryString(),u=this.hash();return this.value(n+(t?"?"+t:"")+(u?"#"+u:"")),this}return ct(r).split("#")[0].split("?")[0]},pathNames:function(){var n=this.path(),t=n.replace(ii,"/").split("/");return(n.substr(0,1)=="/"||n.length===0)&&t.splice(0,1),n.substr(n.length-1,1)=="/"&&t.splice(t.length-1,1),t},queryString:function(n){var t,u;return n!==i?(t=this.hash(),this.value(this.path()+(n?"?"+n:"")+(t?"#"+t:"")),this):(u=r.split("?"),u.slice(1,u.length).join("?").split("#")[0])},parameter:function(t,r,u){var f,o,h,c,e,l,s,a;if(r!==i){for(h=this.parameterNames(),o=[],r=r===i||r===g?"":r.toString(),f=0;f<h.length;f++)for(c=h[f],e=this.parameter(c),typeof e==yi&&(e=[e]),c==t&&(e=r===g||r===""?[]:u?e.concat([r]):[r]),l=0;l<e.length;l++)o.push(c+"="+e[l]);return n.inArray(t,h)==-1&&r!==g&&r!==""&&o.push(t+"="+r),this.queryString(o.join("&")),this}if(r=this.queryString(),r){for(s=[],o=r.split("&"),f=0;f<o.length;f++)a=o[f].split("="),a[0]==t&&s.push(a.slice(1).join("="));if(s.length!==0)return s.length!=1?s:s[0]}},parameterNames:function(){var i=this.queryString(),r=[],u,t,f;if(i&&i.indexOf("=")!=-1)for(u=i.split("&"),t=0;t<u.length;t++)f=u[t].split("=")[0],n.inArray(f,r)==-1&&r.push(f);return r},hash:function(n){if(n!==i)return this.value(r.split("#")[0]+(n?"#"+n:"")),this;var t=r.split("#");return t.slice(1,t.length).join("#")}}}();n.fn.address=function(t){return n(this).each(function(){n(this).data("address")||n(this).on("click",function(i){var r,u;if(i.shiftKey||i.ctrlKey||i.metaKey||i.which==2)return!0;r=i.currentTarget;n(r).is("a")&&(i.preventDefault(),u=t?t.call(r):/address:/.test(n(r).attr("rel"))?n(r).attr("rel").split("address:")[1].split(" ")[0]:n.address.state()!==undefined&&!/^\/?$/.test(n.address.state())?n(r).attr("href").replace(new RegExp("^(.*"+n.address.state()+"|\\.)"),""):n(r).attr("href").replace(/^(#\!?|\.)/,""),n.address.value(u))}).on("submit",function(i){var r=i.currentTarget,u,f;n(r).is("form")&&(i.preventDefault(),u=n(r).attr("action"),f=t?t.call(r):(u.indexOf("?")!=-1?u.replace(/&$/,""):u+"?")+n(r).serialize(),n.address.value(f))}).data("address",!0)}),this}})(jQuery)